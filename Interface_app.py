import streamlit as st
import pandas as pd

# ---------- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ----------
locations = ["‡∏õ‡∏£‡∏∞‡∏ï‡∏π1", "‡∏õ‡∏£‡∏∞‡∏ï‡∏π2", "‡∏õ‡∏£‡∏∞‡∏ï‡∏π3", "‡∏õ‡∏£‡∏∞‡∏ï‡∏π4"]
budgets = ["‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤50", "50 - 100", "100 - 200", "200+"]
types = ["‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß", "‡∏õ‡∏¥‡πâ‡∏á‡∏¢‡πà‡∏≤‡∏á", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô"]
times = ["‡πÄ‡∏ä‡πâ‡∏≤ (‡∏Å‡πà‡∏≠‡∏ô 10 ‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤)", "‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (10‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤ - 4‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)", "‡πÄ‡∏¢‡πá‡∏ô (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 4 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)"]

# ---------- 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ----------
restaurant_data = [
    {"name": "‡∏£‡πâ‡∏≤‡∏ô A", "location": "‡∏õ‡∏£‡∏∞‡∏ï‡∏π1", "budget": "50 - 100", "type_1": "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô", "time_to_open": "‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (10‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤ - 4‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)"},
    {"name": "‡∏£‡πâ‡∏≤‡∏ô B", "location": "‡∏õ‡∏£‡∏∞‡∏ï‡∏π1", "budget": "50 - 100", "type_1": "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô", "time_to_open": "‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (10‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤ - 4‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)"},
    {"name": "‡∏£‡πâ‡∏≤‡∏ô C", "location": "‡∏õ‡∏£‡∏∞‡∏ï‡∏π2", "budget": "100 - 200", "type_1": "‡∏õ‡∏¥‡πâ‡∏á‡∏¢‡πà‡∏≤‡∏á", "time_to_open": "‡πÄ‡∏¢‡πá‡∏ô (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 4 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)"},
    {"name": "‡∏£‡πâ‡∏≤‡∏ô D", "location": "‡∏õ‡∏£‡∏∞‡∏ï‡∏π3", "budget": "200+", "type_1": "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ", "time_to_open": "‡πÄ‡∏¢‡πá‡∏ô (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 4 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)"},
    {"name": "‡∏£‡πâ‡∏≤‡∏ô E", "location": "‡∏õ‡∏£‡∏∞‡∏ï‡∏π4", "budget": "‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤50", "type_1": "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß", "time_to_open": "‡πÄ‡∏ä‡πâ‡∏≤ (‡∏Å‡πà‡∏≠‡∏ô 10 ‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤)"},
]

df = pd.DataFrame(restaurant_data)

# ---------- 3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Session State ----------
if "step" not in st.session_state:
    st.session_state.step = 1
if "selected_restaurant" not in st.session_state:
    st.session_state.selected_restaurant = None

# ---------- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢ ----------
if st.session_state.step == 1:
    st.header("üçΩÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£")

    user_location = st.selectbox("üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì", locations)
    user_type = st.selectbox("üç± ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£", types)
    user_budget = st.selectbox("üí∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", budgets)
    user_time = st.selectbox("‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", times)

    if st.button("üîç ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô"):
        filtered = df[
            (df["location"] == user_location) &
            (df["type_1"] == user_type) &
            (df["budget"] == user_budget) &
            (df["time_to_open"] == user_time)
        ]
        st.session_state.filtered_df = filtered
        st.session_state.step = 2

# ---------- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ----------
elif st.session_state.step == 2:
    st.subheader("üç¥ ‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")

    filtered_df = st.session_state.filtered_df
    selected_radio = None

    if not filtered_df.empty:
        options = [row["name"] for index, row in filtered_df.iterrows()]
        selected_radio = st.radio("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:", options)

        for index, row in filtered_df.iterrows():
            if row["name"] == selected_radio:
                st.markdown(f"""
                    ‚îî üìç **‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì:** {row['location']}  
                    ‚îî üí∏ **‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:** {row['budget']}  
                    ‚îî üç± **‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£:** {row['type_1']}  
                    ‚îî ‚è∞ **‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î:** {row['time_to_open']}  
                """)
                st.markdown("---")

        # ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
        col1, col2 = st.columns(2)
        with col1:
            if st.button("‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"):
                st.session_state.selected_restaurant = selected_radio
                st.session_state.step = 3
        with col2:
            if st.button("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏ñ‡∏π‡∏Å‡πÉ‡∏à"):
                st.session_state.selected_restaurant = None
                st.session_state.step = 3
    else:
        st.warning("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç üò•")
        if st.button("üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà"):
            st.session_state.step = 1

# ---------- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì ----------
elif st.session_state.step == 3:
    st.header("üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£")

    if st.session_state.selected_restaurant:
        st.write("üéâ ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô:")
        st.markdown(f"- üèÜ **{st.session_state.selected_restaurant}**")
    else:
        st.write("üòï ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡∏Ñ‡∏∏‡∏ì")

    if st.button("üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà"):
        st.session_state.step = 1
        st.session_state.selected_restaurant = None
        st.session_state.pop("filtered_df", None)
